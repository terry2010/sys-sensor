# sys-sensor 项目开发进度记录

## 2023-06-01
初始化项目，完成基本框架搭建。

## 2023-06-15
实现基础传感器数据采集与展示。

## 2023-07-01
完成托盘图标与基本UI界面。

## 2023-08-01
优化数据采集性能，减少资源占用。

## 2023-09-15
修复SMART盘符显示问题，完善磁盘健康监控。

## 2023-10-20
修复托盘菜单导航问题，优化用户体验。

## 2023-11-30
完成与iStat Menus差距分析，制定优先补全计划。

## 2024-05-28
完成前端UI展示优化，增强磁盘IOPS、队列长度和磁盘活动百分比等指标的可视化展示。具体改进包括：

1. 在系统详情页面添加磁盘活动百分比指标，基于读写IOPS总量进行估算
2. 在磁盘容量详情卡片中增加IOPS读写详情和队列长度指标展示
3. 增加磁盘使用率百分比计算与展示
4. 实现`fmtDiskActivity`和`fmtDiskDetailIOPS`格式化函数，优化数据展示

这些改进使用户能够更直观地监控磁盘性能状态，特别是在高负载情况下识别潜在的磁盘瓶颈。

## 2024-05-29
完成磁盘文件系统信息采集与展示功能，修复磁盘容量详情中文件系统显示为“---”的问题。具体改进包括：

1. 在 LogicalDiskPayload 结构体中添加 fs 字段，用于存储文件系统类型信息
2. 在磁盘采集链路中添加文件系统信息的获取与传递
3. 前端磁盘详情卡片增加文件系统信息展示

## 2024-05-30
完成网络丢包率和活动连接数等网络质量监控指标的实现。具体改进包括：

1. 扩展 NetIfPayload 结构体，添加丢包率、活动连接数、丢弃包数等字段
2. 改进 wmi_perf_net_err 函数，增加对丢弃包的统计与丢包率计算
3. 新增 get_active_connections 函数，使用 PowerShell 命令获取系统活动连接数
4. 将新增指标集成到主数据采集链路中
5. 在 SensorSnapshot 结构体中添加相应字段，实现前后端数据传递

这些改进使用户能够更全面地监控网络质量，包括丢包率和活动连接数等关键指标，有助于及时发现网络异常。

## 2025-08-15
完成网络丢包率和活动连接数指标在前端界面的展示集成。具体改进包括：

1. 添加了 `fmtPktLoss` 和 `fmtConnections` 格式化函数，用于处理网络丢包率和活动连接数的显示
2. 在主界面网络相关区域添加了“网络丢包率”和“活动连接数”两个指标的显示
3. 在网络接口详情区域也添加了这两个指标的显示
4. 更新了 Details.vue 和 main.ts 中的网络接口类型定义，添加了 `packet_loss_pct` 和 `active_connections` 字段
5. 将相关开发经验更新到项目总结文档，便于后续参考

这些改进完成了网络质量监控指标的全链路打通，从后端数据采集到前端类型定义再到UI渲染组件，使用户能够在主界面和详情页面直观地监控网络质量状况。

## 2024-05-31
修复网络质量监控指标实现中的编译错误。具体改进包括：

1. 修复 bridge_types.rs 中 SensorSnapshot 结构体缺失的网络丢包率与活动连接数字段
2. 修复 wmi_utils.rs 中 PerfTcpipNic 结构体字段错误，使用 bytes_received_per_sec 和 bytes_sent_per_sec 替代不存在的字段
3. 优化网络包计数算法，基于字节数估算总包数（假设平均包大小为1500字节）
4. 修复类型不匹配问题，将 u64 类型转换为 u32 类型

这些修复确保了网络质量监控指标的正常编译和运行，使用户能够获得更准确的网络状态信息。

## 2024-06-01
完成 GPU 深度监控指标的后端映射实现。具体改进包括：

1. 在 lib.rs 中补全 GpuPayload 深度监控字段映射，包括编码/解码单元使用率、显存带宽使用率和 P-State 电源状态
2. 添加 GPU 深度监控指标查询函数调用，从 gpu_utils 模块获取高级指标数据
3. 修复 Option<String> 类型字段的 clone 问题，使用 or_else 和 clone 方法避免所有权移动错误
4. 确保 cargo check 编译通过，为前端展示 GPU 深度监控指标做好准备

这些改进完成了 GPU 深度监控指标的后端映射实现，使系统能够采集和传递更全面的 GPU 性能数据，包括编码/解码单元使用率、显存带宽使用率和电源状态等关键指标。

## 2024-06-02
完成 GPU 深度监控指标的全链路修复。具体改进包括：

1. 在 C# 桥接层 DataModels.cs 中扩展 GpuInfo 类，添加编码/解码单元使用率、显存带宽使用率和性能状态等深度指标字段
2. 在 DataCollector.cs 中修改 GPU 数据采集逻辑，补充深度指标的采集和填充
3. 验证 Rust 后端 bridge_types.rs 中 BridgeGpu 结构体和 types.rs 中 GpuPayload 结构体已包含所有必要的深度指标字段
4. 确认前端 Details.vue 中 fmtGpus 函数已支持格式化和展示所有 GPU 深度指标
5. 完成端到端数据流验证，确保 GPU 详情页能正确显示所有深度指标而非"---"

这些改进修复了 GPU 详情页深度指标显示为"---"的问题，实现了从 C# 桥接层到 Rust 后端再到 Vue3 前端的完整数据流，使用户能够查看更全面的 GPU 性能数据，包括编码/解码单元使用率、显存带宽使用率和性能状态等关键指标，同时保持托盘功能不受影响。

## 2024-06-03
完成 GPU 深度监控指标的映射优先级修复。具体改进包括：

1. 修复 Rust 后端 lib.rs 中 GPU 深度指标的映射逻辑，确保优先使用 C# 桥接层传递的真实数据，而非模拟数据
2. 修改 GPU 深度指标映射代码，将 BridgeGpu 结构体中的 encode_util_pct、decode_util_pct、vram_bandwidth_pct 和 p_state 字段优先映射到 GpuPayload
3. 保留原有的模拟数据生成逻辑作为备选，仅在桥接数据缺失时使用
4. 验证前端 Details.vue 中 fmtGpus 函数已正确处理 GPU 深度指标的显示逻辑
5. 确认主界面（/details 路由）能正确显示 GPU 深度指标，不会显示为"---"

这些改进解决了 GPU 深度指标显示异常的根本原因，即 Rust 后端映射逻辑优先使用模拟数据而忽略 C# 桥接层传递的真实数据。通过修复映射优先级，确保了从 C# 桥接层采集的真实 GPU 深度指标能够正确传递到前端并显示，提高了监控数据的准确性和可靠性。

## 2024-08-15
完成 GPU 深度指标数据流转调试与分析。具体工作包括：

1. 在前端 Details.vue 中添加详细的 GPU 深度指标调试日志，用于跟踪原始数据接收和处理过程
2. 在 Rust 后端 lib.rs 中添加详细的 GPU 深度指标数据流转调试日志，记录桥接层数据、模拟数据和最终数据
3. 修复 Rust 后端调试代码中的 move 语义错误，确保编译成功
4. 完成应用程序的完整构建，准备进行端到端测试
5. 通过日志分析确认数据流转过程中的问题点，为最终修复做准备

这些调试工作旨在全面排查 GPU 深度指标显示为"---"的问题，通过在前后端添加详细日志，跟踪数据从 C# 桥接层到 Rust 后端再到 Vue3 前端的完整流转过程，以便精确定位问题所在并提供针对性解决方案。

## 2024-08-16
完成 GPU 深度指标详情页显示问题修复。具体改进包括：

1. 定位到详情页 GPU 深度指标显示为"---"的根本原因：详情页展开 GPU 详情的模板只绑定了下划线命名（snake_case）的字段，而没有兼容驼峰命名（camelCase）的字段
2. 修改 Details.vue 中的 GPU 详情模板，使其同时兼容两种命名风格，通过空值合并运算符（??）优先使用 snake_case 字段，如果不存在则使用 camelCase 字段
3. 具体修改了编码单元占用、解码单元占用、显存带宽占用和性能状态四个深度指标的渲染模板
4. 确认前端类型定义（main.ts 中的 SensorSnapshot 类型）已包含 GPU 深度指标的 snake_case 字段定义
5. 验证修复后的代码能够正确处理 GPU 深度指标数据，无论是 snake_case 还是 camelCase 命名格式

这些改进解决了 GPU 详情页深度指标显示为"---"的问题，使详情页能够正确显示编码/解码单元使用率、显存带宽使用率和性能状态等关键指标，提高了监控数据的完整性和可用性。修复后的代码具有更好的兼容性，能够适应不同命名风格的数据源，增强了系统的稳定性和可靠性。

## 2024-08-17
修复便携版运行时蓝色命令行窗口一闪而过的问题。具体改进包括：

1. 系统性排查所有使用PowerShell命令的代码，发现在`wmi_utils.rs`中的`get_active_connections`函数未设置`CREATE_NO_WINDOW`标志
2. 修改`get_active_connections`函数，添加`CREATE_NO_WINDOW`标志（0x08000000）以隐藏PowerShell命令窗口
3. 验证其他使用PowerShell命令的文件（如`gpu_utils.rs`、`powershell_utils.rs`、`smartctl_utils.rs`和`nvme_smart_utils.rs`）已正确设置窗口隐藏参数
4. 完成修改后的代码编译检查，确认无编译错误

这些改进解决了便携版运行时蓝色命令行窗口反复一闪而过的问题，提高了应用程序的用户体验和专业性。通过确保所有PowerShell命令执行时都正确隐藏命令行窗口，使应用程序运行更加平滑和无干扰，符合专业软件的质量标准。

## 2025-08-15
修复便携版构建脚本中的JSON语法错误。具体改进包括：

1. 定位到`package.json`中`portable:stage`脚本的JSON解析错误，错误位置在中文文本中包含的双引号导致JSON解析失败
2. 修复中文文本中的双引号问题，将`"localhost 拒绝连接"`修改为不带引号的`localhost拒绝连接`
3. 修复PowerShell环境变量访问语法，将`$env:ProgramFiles(x86)`替换为硬编码路径`\"C:\\Program Files (x86)\\smartmontools\\bin\\smartctl.exe\"`
4. 确保JSON中所有反斜杠和引号都正确转义，避免JSON解析错误
5. 验证修复后的脚本能够正常执行，成功完成便携版构建

这些改进解决了便携版构建过程中的JSON语法错误，使`npm run portable:stage`命令能够正常执行，确保便携版构建过程的顺利完成。通过正确处理JSON中的特殊字符转义和PowerShell命令语法，提高了构建脚本的稳定性和可靠性。