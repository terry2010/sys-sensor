# Windows 系统托盘硬件监控（产品文档）

## 1. 概述
- 这是一个基于 Tauri 的 Windows 系统托盘应用，实时显示关键硬件与系统性能指标。
- 托盘区域以“文本样式”展示两项关键指标（默认：CPU 温度 + CPU 占用率），每秒刷新。
- 鼠标悬停显示 Tooltip 详情；右键菜单上半区为只读信息，下半区为功能菜单。
- 提供详情窗口、快速设置窗口、关于我们弹窗；支持完整退出。

目标平台：Windows 10/11（Win10 21H2 及以上优先）。
开发语言：Rust（Tauri 后端）+ TypeScript/Vue（前端）。

## 2. 目标用户与场景
- 关注电脑硬件健康与性能的用户（玩家、开发者、内容创作者、IT 人员）。
- 希望在不占屏幕空间的前提下，持续观察温度、占用、网速与磁盘读写等关键数据。

## 3. 功能需求

### 3.1 托盘显示
- 托盘“无图标，仅文本”显示两项指标，默认：
  - CPU 温度（单位：℃，四舍五入至整数）。
  - CPU 占用率（百分比，取整）。
- 刷新频率：1 秒。
- 可在“快速设置”中自定义这两项为以下任意两项：
  - CPU 温度、CPU 占用率、CPU 风扇转速
  - 内存占用（已用/百分比）
  - 主板温度
  - 机箱风扇转速（含多个风扇时可选择/聚合）
  - 当前网速（下行/上行/合计，默认显示下行或合计）
  - 当前磁盘读写速度（读、写、合计，默认合计）

### 3.2 鼠标悬停 Tooltip（信息概览）
- 展示以下信息（可读格式，单位自适应）：
  - CPU：温度、占用率
  - 内存：已用/总量、占用率
  - 主板温度
  - 风扇：CPU 风扇转速、机箱风扇转速（可列出多个）
  - 网络：当前网速（上/下/合计，单位 KB/s/MB/s，自动选择）
  - 磁盘：当前读写速度（读/写/合计，单位 KB/s/MB/s）
- 数据与托盘刷新保持一致（1 秒）。

### 3.3 右键菜单
- 上半区：同 Tooltip 的信息概览，只读不可点击。
- 下半区（可点击）：
  - 显示详情
  - 快速设置
  - 关于我们
  - 退出（彻底关闭进程）

### 3.4 详情窗口
- 展示所有传感器与系统信息的实时数据：
  - CPU、内存、主板温度、各风扇转速
  - 当前网速（分网络接口，支持聚合/选择）
  - 当前磁盘读写（分磁盘，支持聚合/选择）
  - 占用资源最多的进程列表（按 CPU、按内存）
- 支持单位自适应与合理的小数位控制。

### 3.5 快速设置
- 允许在候选项中选择“托盘显示的两项数据”（见 3.1）。
- 选择网络与磁盘来源：
  - 网络：多网卡时可选择“自动（聚合真实物理/活动接口）/指定接口”。
  - 磁盘：可选择“系统盘/最繁忙磁盘/指定磁盘/聚合”。
- 设置保存到本地 JSON 配置，重启后生效。

### 3.6 关于我们
- 弹窗展示：
  - 软件官网链接
  - 作者微博/联系方式

### 3.7 退出
- 彻底关闭程序（释放所有资源与后台子进程）。

## 4. 非功能性需求
- 资源占用低、稳定运行；异常情况下自动恢复采集或给出明确错误提示。
- 对杀软/安全策略兼容性好；必要时提供白名单说明。
- 日志级别可调（仅开发/调试启用详细日志）。

## 5. 技术架构
- 后端：Tauri（Rust）。
  - 进程管理、定时采集、托盘渲染（动态文本转 32x32 RGBA 图）、Tooltip 与菜单。 
  - 与前端的 IPC 通信（命令与事件广播）。
- 数据采集：
  - `sysinfo`：CPU/内存/进程列表/网络累计字节/磁盘累计读写字节。
  - 传感器桥（.NET, C#）：基于 `LibreHardwareMonitorLib` 获取主板温度与风扇转速，通过子进程输出 JSON 与 Rust 交互。
- 前端：Vue + TypeScript + Vite。
- 配置：本地 JSON（用户目录 AppData 下），包含托盘两个指标选择、网络/磁盘来源策略等。

## 6. 数据与算法
- 采样周期：1 秒（可调）。
- 网速/磁盘吞吐：由累计字节计数做差分，除以时间间隔得到速率；
  - 平滑：使用指数滑动平均（EMA），参数 α 默认 0.3；
  - 单位自适应：< 1024 KB/s 用 KB/s，否则用 MB/s；保留 1 位小数。
- 多设备处理：
  - 网络：过滤虚拟/非活动接口，默认聚合活动的物理接口；支持指定单一接口。
  - 磁盘：默认系统盘或最繁忙磁盘；支持聚合或指定。

## 7. 托盘文本渲染
- 动态绘制字符串（例如 “65℃ 42%”）到 32x32 RGBA 图像，传入 Tauri 托盘 API 更新图标。
- 字体渲染考虑 DPI 缩放与对比度，确保清晰可读。

## 8. 权限与风险对策
- 权限：大多数采集无需管理员；若桥接读取失败，提示以管理员运行或启用驱动/传感器支持。
- 杀软拦截：提供白名单说明；签名后发布以降低误报。
- 依赖：
  - VC++、Windows SDK、WebView2 运行时：在安装指引中明确说明；
  - .NET 8.0 用于传感器桥；
  - 无法获取到的传感器项给出“不可用”的友好提示。

## 9. 发布与更新
- 提供安装包（.msi/.exe），包含必要运行时检测与提示。
- 后续可考虑自动更新（可选）。

## 10. 术语
- 合计速率：上行 + 下行/读 + 写。
- EMA：指数滑动平均，用于抑制抖动。
